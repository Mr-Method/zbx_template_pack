<?xml version="1.0" encoding="UTF-8"?>
<root xmlns="http://www.example.org/zbx_template_new/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.example.org/zbx_template_new/ ../../src/main/resources/templates/metrics.xsd">
    <template>
        <name>Template Net Mikrotik_SNMPvX</name>
        <classes>
            <class>Inventory</class>
            <class>Performance</class>
            <class>Fault</class>
            <class>Interfaces</class>
            <class>Network</class>
            <class>SNMP Device</class>
            <class>SNMPv2</class>
        </classes>
        <description>Template Net Mikrotik version: 0.14
            MIBs used:
            HOST-RESOURCES-MIB
            MIKROTIK-MIB
            Known Issues:
            description : Doesn't have ifHighSpeed filled. fixed in more recent versions
            version : RotuerOS 6.28 or lower
            device : description : Doesn't have any temperature sensors
            version : RotuerOS 6.38.5
            device : Mikrotik 941-2nD, Mikrotik 951G-2HnD</description>
        <sysObjectID>1.3.6.1.4.1.14988.1</sysObjectID>
        <documentation>
            <issues>
                <issue>
                    <description>Doesn't have ifHighSpeed filled. fixed in more recent versions</description>
                    <version>RotuerOS 6.28 or lower</version>
                    <device/>
                </issue>
                <issue>
                    <description>Doesn't have any temperature sensors</description>
                    <version>RotuerOS 6.38.5</version>
                    <device>Mikrotik 941-2nD, Mikrotik 951G-2HnD</device>
                </issue>
            </issues>
        </documentation>

        <!--
    The Management Information Base (MIB) is the database of information maintained by the agent that the manager can query. You can download the latest MikroTik RouterOS MIB file (Last updated: 2-MAR-2017).

    MIBs used in RouterOS v6.x:

    MIKROTIK-MIB
    MIB-2
    HOST-RESOURCES-MIB
    IF-MIB
    IP-MIB
    IP-FORWARD-MIB
    IPV6-MIB
    BRIDGE-MIB
    DHCP-SERVER-MIB
    CISCO-AAA-SESSION-MIB
    ENTITY-MIB
    UPS-MIB
    SQUID-MIB -->

        <discoveryRules>
            <discoveryRule>
                <name>CPU Discovery</name>
                <snmp_oid>discovery[{#SNMPVALUE},1.3.6.1.2.1.25.3.3.1.1]</snmp_oid>
                <key>hrProcessorLoad.discovery</key>
                <description>HOST-RESOURCES-MIB::hrProcessorTable discovery</description>
            </discoveryRule>
            <discoveryRule>
                <name>Temperature Discovery CPU</name>
                <snmp_oid>discovery[{#SNMPVALUE},1.3.6.1.4.1.14988.1.1.3.11]</snmp_oid>
                <key>mtxrHlProcessorTemperature.discovery</key>
                <description>MIKROTIK-MIB::mtxrHlProcessorTemperature
                    Since temperature of CPU is not available on all Mikrotik hardware, this is done to avoid unsupported items.</description>
            </discoveryRule>

            <discoveryRule>
                <!-- discover storage -->
                <name>Storage Discovery</name>
                <snmp_oid>discovery[{#SNMPVALUE},1.3.6.1.2.1.25.2.3.1.3,{#ALLOC_UNITS},1.3.6.1.2.1.25.2.3.1.4,{#STORAGE_TYPE},1.3.6.1.2.1.25.2.3.1.2]</snmp_oid>
                <key>storage.discovery</key>
                <description>HOST-RESOURCES-MIB::hrStorage discovery with storage filter</description>
                <filter>
                    <evaltype>2</evaltype>
                    <formula/>
                    <conditions>
                        <condition>
                            <macro>{#STORAGE_TYPE}</macro>
                            <value>.+4$</value>
                            <operator>8</operator>
                            <formulaid>B</formulaid>
                        </condition>
                        <condition>
                            <macro>{#STORAGE_TYPE}</macro>
                            <value>.+hrStorageFixedDisk</value>
                            <operator>8</operator>
                            <formulaid>A</formulaid>
                        </condition>
                    </conditions>
                </filter>
            </discoveryRule>

        </discoveryRules>
        <metrics>
            <system.cpu.util>
                <documentation/>
                <name lang="EN">#{#SNMPINDEX}: CPU utilization</name>
                <name lang="RU">#{#SNMPINDEX}: Загрузка проца</name>
                <!--<name >#{#SNMPINDEX}: Загрузка процессора</name>-->
                <group>CPU</group>
                <oid>1.3.6.1.2.1.25.3.3.1.2.{#SNMPINDEX}</oid>
                <snmpObject>system.cpu.util[hrProcessorLoad.{#SNMPINDEX}]</snmpObject>
                <mib>HOST-RESOURCES-MIB</mib>
                <itemType>snmp</itemType>
                <vendorDescription>The average, over the last minute, of the percentage of time that this processor was not idle.Implementations may approximate this one minute smoothing period if necessary.</vendorDescription>
                <description>MIB: HOST-RESOURCES-MIB
                    The average, over the last minute, of the percentage of time that this processor was not idle.Implementations may approximate this one minute smoothing period if necessary.
                </description>
                <history>30</history>
                <trends>365</trends>
                <units>%</units>
                <update>180</update>
                <valueType>0</valueType>
                <valueMap/>
                <multiplier/>
                <preprocessing/>
                <alarmObject>#{#SNMPINDEX}</alarmObject>
                <discoveryRule>CPU Discovery</discoveryRule>
                <triggers>
                    <trigger>
                        <documentation>If alarmObject is defined, it's added to trigger name.</documentation>
                        <expression>{TEMPLATE_NAME:system.cpu.util[hrProcessorLoad.{#SNMPINDEX}].avg(5m)}&gt;{$CPU_UTIL_MAX}</expression>
                        <recovery_expression/>
                        <name >#{#SNMPINDEX}: High CPU utilization</name>
                        <name >#{#SNMPINDEX}: Высокая загрузка процессора</name>
                        <url/>
                        <priority>3</priority>
                        <description>Last value: {ITEM.LASTVALUE1}.
                        </description>
                        <tags>
                            <tag>
                                <tag>Alarm.object.type</tag>
                                <value>CPU</value>
                            </tag>
                            <tag>
                                <tag>Alarm.type</tag>
                                <value>CPU_UTIL_HIGH</value>
                            </tag>
                            <tag>
                                <tag>Host</tag>
                                <value>{HOST.HOST}</value>
                            </tag>
                        </tags>
                    </trigger>
                </triggers>
                <graphs>
                    <graph>
                        <name>#{#SNMPINDEX}: CPU utilization</name>
                        <width>900</width>
                        <height>200</height>
                        <yaxismin>0</yaxismin>
                        <ymin_type_1>1</ymin_type_1>
                        <yaxismax>100</yaxismax>
                        <ymax_type_1>1</ymax_type_1>
                        <show_work_period>1</show_work_period>
                        <show_triggers>1</show_triggers>
                        <type>0</type>
                        <show_legend>1</show_legend>
                        <show_3d>0</show_3d>
                        <percent_left>0.0000</percent_left>
                        <percent_right>0.0000</percent_right>
                        <ymin_item_1>0</ymin_item_1>
                        <ymax_item_1>0</ymax_item_1>
                        <graph_items>
                            <graph_item>
                                <sortorder>0</sortorder>
                                <drawtype>5</drawtype>
                                <color>1A7C11</color>
                                <yaxisside>0</yaxisside>
                                <calc_fnc>2</calc_fnc>
                                <type>0</type>
                                <item>
                                    <host>Template Net Mikrotik_SNMPvX</host>
                                    <key>system.cpu.util[hrProcessorLoad.{#SNMPINDEX}]</key>
                                </item>
                            </graph_item>
                        </graph_items>
                    </graph>
                </graphs>
            </system.cpu.util>



        </metrics>


        <macros>
            <macro>
                <macro>{$TEMP_CRIT:"CPU"}</macro>
                <value>75</value>
            </macro>
            <macro>
                <macro>{$TEMP_WARN:"CPU"}</macro>
                <value>70</value>
            </macro>
            <macro>
                <macro>{$CPU_UTIL_MAX}</macro>
                <value>90</value>
            </macro>
            <macro>
                <macro>{$MEMORY_UTIL_MAX}</macro>
                <value>90</value>
            </macro>
            <macro>
                <macro>{$TEMP_CRIT}</macro>
                <value>60</value>
            </macro>
            <macro>
                <macro>{$TEMP_WARN}</macro>
                <value>50</value>
            </macro>
            <macro>
                <macro>{$TEMP_CRIT_LOW}</macro>
                <value>5</value>
            </macro>
            <macro>
                <macro>{$STORAGE_UTIL_CRIT}</macro>
                <value>90</value>
            </macro>
            <macro>
                <macro>{$STORAGE_UTIL_WARN}</macro>
                <value>80</value>
            </macro>
        </macros>
        <templates>
            <template>
                <name>Template Module Interfaces_SNMPvX</name>
            </template>
            <template>
                <name>Template Module Generic_SNMPvX</name>
            </template>
        </templates>
    </template>
</root>